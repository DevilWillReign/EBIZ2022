FROM golang:1.18-buster

ARG FRONT_HOST=http://localhost:9001
ARG API_HOST=localhost
ARG API_PORT=9000
ARG SESSION_SECRET
ARG JWT_SECRET
ARG GOOGLE_OAUTH_CLIENT_ID
ARG GOOGLE_OAUTH_CLIENT_SECRET
ARG GH_OAUTH_CLIENT_ID
ARG GH_OAUTH_CLIENT_SECRET
ARG GL_OAUTH_CLIENT_ID
ARG GL_OAUTH_CLIENT_SECRET

ENV FRONT_HOST ${FRONT_HOST}
ENV API_HOST ${API_HOST}
ENV API_PORT ${API_PORT}
ENV SESSION_SECRET ${SESSION_SECRET}
ENV JWT_SECRET ${JWT_SECRET}
ENV GOOGLE_OAUTH_CLIENT_ID ${GOOGLE_OAUTH_CLIENT_ID}
ENV GOOGLE_OAUTH_CLIENT_SECRET ${GOOGLE_OAUTH_CLIENT_SECRET}
ENV GH_OAUTH_CLIENT_ID ${GH_OAUTH_CLIENT_ID}
ENV GH_OAUTH_CLIENT_SECRET ${GH_OAUTH_CLIENT_SECRET}
ENV GL_OAUTH_CLIENT_ID ${GL_OAUTH_CLIENT_ID}
ENV GL_OAUTH_CLIENT_SECRET ${GL_OAUTH_CLIENT_SECRET}

RUN useradd -m -s /bin/bash appuser
USER appuser
WORKDIR /home/appuser

COPY go.mod ./
COPY go.sum ./

RUN go mod download

COPY . .

RUN go build -o appritstoreback

CMD [ "appritstoreback" ]
